- name: Setup Software
  hosts: joplin
  gather_facts: false
  tasks:
    - name: Wait for connection
      ansible.builtin.wait_for:
        host: "{{ inventory_hostname }}"
        port: 22
        timeout: 300
      delegate_to: localhost
    - name: Test some stuff
      ansible.builtin.shell: |
        touch ~/hmm
        echo test > ~/test
        echo test2 >> ~/test
        mkdir ~/dir
        touch ~/dir/testing
      register: stuff
      retries: 10
      delay: 6
      until: stuff.rc == 0
    - name: Install some stuff
      ansible.builtin.apt:
        update_cache: true
        name: qemu-guest-agent
    - name: Enable some stuff
      ansible.builtin.systemd:
        name: qemu-guest-agent
        state: started
        enabled: true
